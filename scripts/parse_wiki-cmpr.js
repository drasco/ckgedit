function parse_wikitext(t){if(ckgedit_dwedit_reject)return GetE("ebut_cancel").click(),!0;var e=getComplexTables();function i(t,e,i){for(var s=new Array,a=e;a<t.length;a++)for(var n=0;n<t[a].length;n++)if(t[a][n].rowspan>0){var l=t[a][n].text;if(s.push({row:a,column:n,spans:t[a][n].rowspan,text:l}),!i)break}return s}function s(t,e,i,s,a){var n=s[t][e].colspan?s[t][e].colspan:0;for(s[t][e].rowspan=0,P=0;P<i-1;P++)s[++t].splice(e,0,{type:"td",rowspan:0,colspan:n,prev_colspan:n,text:" ::: "})}function a(t){var e=i(t,0,!0),a=e.length;if(!a)return!1;var n=e[0].row;s(n,e[0].column,e[0].spans,t),a--;for(var l=0;l<a;l++){var r=i(t,++n,!1);r.length&&s(r[0].row,r[0].column,r[0].spans,t)}return!0}window.dwfckTextChanged=!1,"bakup"!=t&&draft_delete();var n={b:"**",i:"//",em:"//",u:"__",br:"\nL_BR_K  \n",strike:"<del>",del:"<del>",s:"<del>",p:"\n\n",a:"[[",img:"{{",strong:"**",h1:"\n====== ",h2:"\n===== ",h3:"\n==== ",h4:"\n=== ",h5:"\n== ",td:"|",th:"^",tr:" ",table:"\n\n",ol:"  - ",ul:"  * ",li:"",code:"''",pre:"\n<",hr:"\n\n----\n\n",sub:"<sub>",font:"",sup:"<sup>",div:"\n\n",span:"\n",dl:"\n",dd:"\n",dt:"\n"},l={del:"</del>",s:"</del>",strike:"</del>",p:" ",br:" ",a:"]]",img:"}}",h1:" ======\n",h2:" =====\n",h3:" ====\n",h4:" ===\n",h5:" ==\n",td:" ",th:" ",tr:"|\n",ol:" ",ul:" ",li:"\n",pre:"\n</",sub:"</sub>",sup:"</sup> ",div:"\n\n",p:"\n\n",font:"</font>",span:" "};n.temp_u="CKGE_TMP_u",n.temp_strong="CKGE_TMP_strong",n.temp_em="CKGE_TMP_em",n.temp_i="CKGE_TMP_i",n.temp_b="CKGE_TMP_b",n.temp_del="CKGE_TMP_del",n.temp_strike="CKGE_TMP_strike",n.temp_code="CKGE_TMP_code",n.temp_sup="CKGE_TMP_sup",n.temp_csup="CKGE_TMP_csup",n.temp_sub="CKGE_TMP_sub",n.temp_csub="CKGE_TMP_csub",n.temp_del="CKGE_TMP_del",n.temp_cdel="CKGE_TMP_cdel",n.temp_strike="CKGE_TMP_del",n.temp_cstrike="CKGE_TMP_cdel",n.temp_s="CKGE_TMP_del",n.temp_cs="CKGE_TMP_cdel";var r={CKGE_TMP_b:"**",CKGE_TMP_strong:"**",CKGE_TMP_em:"//",CKGE_TMP_u:"__",CKGE_TMP_sup:"<sup>",CKGE_TMP_sub:"<sub>",CKGE_TMP_cdel:"</del>",CKGE_TMP_csub:"</sub>",CKGE_TMP_csup:"</sup>",CKGE_TMP_del:"<del>",CKGE_TMP_strike:"<del>",CKGE_TMP_code:"''"};n.blank="",n.fn_start="((",n.fn_end="))",n.row_span=":::",n.p_insert="_PARA__TABLE_INS_",n.format_space="_FORMAT_SPACE_",n.pre_td="<";var _={strong:!0,b:!0,i:!0,em:!0,u:!0,del:!0,strike:!0,code:!0,sup:!0,sub:!0,s:!0},c="",h=!1,o=!1,p=!1,d=!1,m=!1,f=!1,u=!1,g=!1,k=!1,v=!1,w=!1;HTMLLinkInList=!1;var b=!1,y=new Array,E=new Array,C=!1,T=n.p_insert,x="(br|co|coMULTI|es|kw|me|nu|re|st|sy)[0-9]";if(String.prototype.splice=function(t,e,i){return this.slice(0,t)+i+this.slice(t+Math.abs(e))},String.frasl=new RegExp("⁄|&frasl;|&#8260;|&#x2044;","g"),x=new RegExp(x),HTMLParser(CKEDITOR.instances.wiki__text.getData(),{attribute:"",link_title:"",link_class:"",image_link_type:"",td_align:"",in_td:!1,td_colspan:0,td_rowspan:0,rowspan_col:0,last_column:-1,row:0,col:0,td_no:0,tr_no:0,current_row:!1,in_table:!1,in_multi_plugin:!1,is_rowspan:!1,list_level:0,prev_list_level:-1,list_started:!1,xcl_markup:!1,in_link:!1,link_formats:new Array,last_tag:"",code_type:!1,in_endnotes:!1,is_smiley:!1,geshi:!1,downloadable_code:!1,export_code:!1,code_snippet:!1,downloadable_file:"",external_mime:!1,in_header:!1,curid:!1,format_in_list:!1,prev_li:new Array,link_only:!1,in_font:!1,using_fonts:!1,interwiki:!1,bottom_url:!1,font_family:"inherit",font_size:"inherit",font_weight:"inherit",font_color:"inherit",font_bgcolor:"inherit",font_style:"inherit",is_mediafile:!1,end_nested:!1,mfile:!1,backup:function(t,e){var i=c.lastIndexOf(t),s=c.indexOf(e,i);if(-1!=i&&-1!=s){if(t.length+s==s){var a=c.substring(0,i),n=c.substring(s);return c=a+n,!0}return!1}},is_iwiki:function(t,e){var i=t.match(/iw_(\w+\.?\w{0,12})/),s=e.split(/\//),a=s[s.length-1];(a=a.replace(String.frasl,"/")).match(/oIWIKIo.*?cIWIKIc/)||(a="oIWIKIo"+a+"cIWIKIc"),a=(a=a.replace(/^.*?oIWIKIo/,"oIWIKIo")).replace(/cIWIKIc.*/,"cIWIKIc"),i[1]=i[1].replace(/_(\w{2})/g,".$1"),this.attr=i[1]+">"+decodeURIComponent(a),v=!0,this.interwiki=!0},start:function(t,e,i){if(n[t]){if(_[t]&&this.in_link)return void this.link_formats.push(t);var s;if(_[t]&&(this.in_font||this.in_header))return c+=" ",c+=n["temp_"+t],void(c+=" ");if("acronym"==t)return;if(_[t]&&this.in_endnotes&&"sup"==t)return;if("ol"==t||"ul"==t)return this.prev_list_level=this.list_level,this.list_level++,1==this.list_level&&(this.list_started=!1),this.list_started&&this.prev_li.push(n.li),void(n.li=n[t]);if(this.list_level||(n.li="",this.prev_li=new Array),this.is_mediafile=!1,"img"==t){var a,l,r="?",f=!1,g="",k="",v=!1;this.is_smiley=!1,this.in_link=!1}if("a"==t){var w=!0,b="";this.xcl_markup=!1,this.in_link=!0,this.link_pos=c.length,this.link_formats=new Array,this.footnote=!1;var E=!1;this.id="",this.external_mime=!1;var C=!1;this.export_code=!1,this.code_snippet=!1,this.downloadable_file="";var I=!1;this.link_only=!1,save_url="",this.interwiki=!1,this.bottom_url=!1,this.link_title=!1;var K="",$=""}if("p"==t)if(this.in_link=!1,this.in_table)t="p_insert",d=!0;else if(this.list_started)return;"table"==t?(this.td_no=0,this.tr_no=0,this.in_table=!0,this.is_rowspan=!1,this.row=-1,this.rows=new Array,this.rows,this.table_start=c.length):"tr"==t?(this.tr_no++,this.td_no=0,this.col=-1,this.row++,this.rows[this.row]=new Array,this.current_row=this.rows[this.row]):"td"!=t&&"th"!=t||(this.td_no++,this.col++,this.current_row[this.col]={type:t,rowspan:0,colspan:0,text:""},this.cell_start=c.length,this.current_cell=this.current_row[this.col],this.td_rowspan&&this.rowspan_col==this.td_no&&this.td_no!=this.last_column?(this.is_rowspan=!0,this.td_rowspan--):this.is_rowspan=!1),this.attr=!1,this.format_tag=!1,_[t]&&(this.format_tag=!0);for(var P=!1,A=0;A<e.length;A++){if("td"!=t&&"th"!=t||("colspan"==e[A].name&&(this.current_row[this.col].colspan=e[A].value),"class"==e[A].name&&(s=e[A].value.match(/(left|center|right)/))&&(this.current_row[this.col].align=s[1]),"rowspan"==e[A].name&&(this.current_row[this.col].rowspan=e[A].value)),"u"==e[A].escaped&&"em"==t){t="u",this.attr="u";break}if("div"==t){"class"==e[A].name&&"footnotes"==e[A].value&&(t="blank",this.in_endnotes=!0);break}if("dl"==t&&"class"==e[A].name&&"file"==e[A].value)return this.downloadable_code=!0,void(p=!0);if("span"==t&&"class"==e[A].name&&"np_break"==e[A].value)return;if("span"==t&&"class"==e[A].name){if("curid"==e[A].value)return void(this.curid=!0);if("multi_p_open"==e[A].value)return this.in_multi_plugin=!0,void(u=!0);if("multi_p_close"==e[A].value)return void(this.in_multi_plugin=!1);if(e[A].value.match(x)){t="blank",this.geshi=!0;break}}if("span"==t&&!ckgedit_xcl_styles&&"style"==e[A].name){this.in_font||(c+="__STYLE__"),this.in_font=!0,this.using_fonts=!0,(s=e[A].value.match(/font-family:\s*([\w\-\s,]+);?/))&&(this.font_family=s[1]),(s=e[A].value.match(/font-size:\s*(.*)/))&&(s[1]=s[1].replace(/;/,""),this.font_size=s[1]),(s=e[A].value.match(/font-weight:\s*(\w+);?/))&&(this.font_weight=s[1]);(s=e[A].value.match(/.*?color:\s*(.*)/))&&(s[1]=s[1].replace(/;/,""),s[0].match(/background/)?this.font_bgcolor=s[1]:this.font_color=s[1]),(s=e[A].value.match(/background:\s*(\w+)/))&&s[0].match(/background/)&&(this.font_bgcolor=s[1])}if("td"!=t&&"th"!=t||("td"==t&&(c=c.replace(/\^$/,"|")),this.in_td=!0,"align"==e[A].name?this.td_align=e[A].escaped:"class"==e[A].name?(s=e[A].value.match(/\s*(\w+)align/))&&(this.td_align=s[1]):"colspan"==e[A].name?(m=!0,this.td_colspan=e[A].escaped):"rowspan"==e[A].name&&(this.td_rowspan=e[A].escaped-1,this.rowspan_col=this.td_no),d=!0),"a"==t)if("title"==e[A].name)this.link_title=e[A].escaped,$?K=e[A].escaped:this.link_title=this.link_title.replace(/\s+.*$/,"");else if("class"==e[A].name){if(e[A].value.match(/fn_top/))this.footnote=!0;else if(e[A].value.match(/fn_bot/))E=!0;else if(e[A].value.match(/mf_(png|gif|jpg|jpeg)/i))this.link_only=!0;else if(e[A].value.match(/interwiki/)){e[A].value=e[A].value.replace(/\./g,"_"),this.link_class=e[A].value;continue}this.link_class=e[A].escaped,C=this.link_class.match(/mediafile/)}else if("id"==e[A].name)this.id=e[A].value;else if("type"==e[A].name)b=e[A].value;else if("href"==e[A].name&&!this.code_type){var R=!!e[A].escaped.match(/https*:\/\//);if(R&&(save_url=e[A].escaped),e[A].escaped.match(/\/lib\/exe\/detail.php/)?this.image_link_type="detail":e[A].escaped.match(/exe\/fetch.php/)&&(this.image_link_type="direct"),this.link_class&&this.link_class.match(/media/)&&!this.link_title){var L=e[A].escaped.match(/media=(.*)/);L&&(this.link_title=L[1])}var M=e[A].escaped.match(/fetch\.php.*?media=.*?\.(png|gif|jpg|jpeg)$/i);if(M&&(M=M[1]),e[A].escaped.match(/^https*:/)&&(this.attr=e[A].escaped,w=!1),e[A].escaped.match(/^ftp:/))this.attr=e[A].escaped,w=!1;else if(e[A].escaped.match(/do=export_code/))this.export_code=!0;else if(e[A].escaped.match(/^nntp:/))this.attr=e[A].escaped,w=!1;else if(e[A].escaped.match(/^mailto:/))this.attr=e[A].escaped.replace(/mailto:/,""),w=!1;else if(e[A].escaped.match(/m-files/))this.attr=e[A].escaped,this.mfile=e[A].escaped,w=!1;else if(e[A].escaped.match(/^file:/)){var S=e[A].value.replace(/file:[\/]+/,"");S="\\\\"+(S=S.replace(/[\/]/g,"\\")),this.attr=S,w=!1}else if(R&&!M&&(s=e[A].escaped.match(/fetch\.php(.*)/))){if(s[1].match(/media=/)?(N=s[1].split(/=/),this.attr=N[1]):(s[1]=s[1].replace(/^\//,""),this.attr=s[1]),"undefined"!=typeof config_animal){var O=new RegExp(config_animal+"/file/(.*)");(s=e[A].escaped.match(O))&&s[1]&&(this.attr=s[1]),this.attr&&(this.attr=this.attr.replace(/\//g,":"))}w=!1,this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr),this.attr.match(/^:/)||(this.attr=":"+this.attr),this.external_mime=!0}else{if(w=!1,(s=e[A].escaped.match(/doku.php\?id=(.*)/))&&save_url){var G=DOKU_BASE+"doku.php";e[A].escaped.match(G)||(this.link_class,this.attr=save_url,s=null)}if(s||(s=e[A].escaped.match(/doku.php\/(.*)/)),s&&!s[1].match(/\?/)&&s[1].match(/&amp;/)&&(I=!0,s[1]=s[1].replace(/&amp;/,"?")),s&&s[1]){if(s[1].match(/^:/)?this.attr=s[1]:this.attr=":"+s[1],this.attr.match(/\.\w+$/))if(b&&"other_mime"==b)this.external_mime=!0;else for(var F=A+1;F<e.length;F++){e[F].value.match(/other_mime/)&&(this.external_mime=!0);break}}else(s=e[A].value.match(/\\\\/))&&(this.attr=e[A].escaped,w=!1)}if("media"==this.link_class&&e[A].value.match(/http:/)&&(w=!1),!this.attr&&this.link_title&&(s=this.link_class.match(/media(.*)/))){this.link_title=decodeURIComponent(safe_convert(this.link_title)),this.attr=this.link_title;var j=s[1].split(/_/);M=j&&j[1]?j[1]:j?j[0]:"mf",this.attr.match(/^:/)||this.attr.match(/^https?\:/)||(this.attr=":"+this.attr.replace(/^\s+/,"")),this.external_mime=!0,w=!1}if(this.attr.match&&this.attr.match(/%[a-fA-F0-9]{2}/)&&(s=this.attr.match(/userfiles\/file\/(.*)/))?(s[1]=s[1].replace(/\//g,":"),s[1].match(/^:/)||(s[1]=":"+s[1]),this.attr=decodeURIComponent?decodeURIComponent(s[1]):unescape(s[1]),this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr),this.external_mime=!0):this.attr&&this.attr.match(/%[a-fA-F0-9]{2}/)&&(this.attr=decodeURIComponent(this.attr),this.attr=decodeURIComponent(this.attr)),this.link_title&&this.link_title.match(/Snippet/)&&(this.code_snippet=!0),e[A].value.match(/^#/)&&this.link_class.match(/wikilink/)&&(this.attr=e[A].value,this.link_title=!1),this.link_class.match(/wikilink/)&&this.link_title){if(this.external_mime=!1,this.attr||(this.attr=this.link_title),this.attr.match(/^:/)||(this.attr=":"+this.attr),this.attr.match(/\?.*?=/))(N=this.attr.split(/\?/))[0]=N[0].replace(/\//g,":"),this.attr=N[0]+"?"+N[1];else this.attr=this.attr.replace(/\//g,":");if(!I&&"href"==e[A].name&&!this.attr.match(/\?.*?=/)&&!e[A].value.match(/doku.php/)){var W=e[A].value.match(/(\?.*)$/);W&&W[1]&&(this.attr+=W[1])}}else this.link_class.match(/mediafile/)&&this.link_title&&!this.attr?(this.attr=this.link_title,this.external_mime=!0,this.attr.match(/^:/)||(this.attr=":"+this.attr)):this.link_class.match(/interwiki/)&&($=this.link_class);"urlextern"==this.link_class&&!this.mfile&&save_url&&(this.attr=save_url,this.external_mime=!1),this.in_endnotes&&(this.link_title?this.bottom_url=this.link_title:this.attr&&(this.bottom_url=this.attr)),this.link_title="",this.link_class=""}if($&&K&&(this.is_iwiki($,K),$="",K=""),"sup"==t&&"class"==e[A].name&&"dwfcknote"==(s=e[A].value.split(/\s+/))[0]){this.attr=s[0],t="blank",oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[s[1]]&&(P="(("+oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[s[1]]+"))");break}if("pre"==t){if("class"==e[A].name){(N=e[A].escaped.split(/\s+/)).length>1?(this.attr=e[A].value,this.code_type=N[0]):(this.attr=e[A].escaped,this.code_type=this.attr),this.downloadable_code&&(this.attr=this.attr.replace(/\s*code\s*/,""),this.code_type="file"),o=!0,this.in_table&&(t="pre_td");break}}else if("img"==t)if("alt"==e[A].name&&(k=e[A].value),"type"==e[A].name&&(this.image_link_type=e[A].value),"src"==e[A].name){var Q="";if(s=e[A].escaped.match(/fetch\.php.*?(media=.*)/)){if(Q=(N=s[1].split("="))[1],s=e[A].escaped.match(/(media.*)/)){var B=(N=s[1].split("="))[1];Q=decodeURIComponent?decodeURIComponent(B):unescape(B)}Q.match(/https?:/)||Q.match(/^:/)||(Q=":"+Q)}else if(e[A].escaped.match(/https?:\/\//))Q=(Q=e[A].escaped).replace(/\?.*?$/,"");else if(s=e[A].escaped.match(/\/_media\/(.*)/)){(Q=(Q=(N=s[1].split(/\?/))[0]).replace(/\//g,":")).match(/^:/)||(Q=":"+Q)}else if(s=e[A].escaped.match(/\/lib\/exe\/fetch.php\/(.*)/)){var N;(Q=(N=s[1].split(/\?/))[0]).match(/^:/)||(Q=":"+Q)}else{if(!(s=e[A].escaped.match(/^.*?\/userfiles\/image\/(.*)/))&&"undefined"!=typeof config_animal){O=new RegExp(config_animal+"/image/(.*)$");s=e[A].escaped.match(O)}if(!s)O="^.*?"+(O=(O=doku_base+"data/media/").replace(/([\/\\])/g,"\\$1"))+"(.*)",O=new RegExp(O),s=e[A].escaped.match(O);s&&s[1]?Q=":"+(Q=s[1].replace(/\//g,":")):(Q=decodeURIComponent?decodeURIComponent(e[A].escaped):unescape(e[A].escaped)).search(/data:image.*?;base64/)>-1&&(v=!0)}Q&&Q.match(/lib\/images\/smileys/)&&(this.is_smiley=!0),this.attr=Q,this.attr&&this.attr.match&&this.attr.match(/%[a-fA-F0-9]{2}/)&&(this.attr=decodeURIComponent(safe_convert(this.attr)),this.attr=decodeURIComponent(safe_convert(this.attr)))}else if("width"!=e[A].name||f)if("height"!=e[A].name||f)if("style"==e[A].name){var U;if(U=e[A].escaped.match(/width:\s*(\d+)/))a=U[1],(U=e[A].escaped.match(/height:\s*(\d+)/))&&(l=U[1])}else"align"!=e[A].name&&"class"!=e[A].name||(g=e[A].escaped.match(/(center|middle)/)?"center":e[A].escaped.match(/right/)?"right":e[A].escaped.match(/left/)?"left":"");else l=e[A].value;else a=e[A].value}if(this.is_smiley)return k&&(c+=k+" ",k=""),void(this.is_smiley=!1);if(this.link_only&&(t="img"),"br"==t){if(this.in_multi_plugin)return void(c+="\n");if(this.code_type){if(this.code_type)return void(c+="\n")}else h=!0;if(this.in_table)return void(c+=T);if(!this.list_started)return void(c+="\\\\  ");c+="_LIST_EOFL_"}else if(t.match(/^h(\d+|r)/)){var H=c.length;t.match(/h(\d+)/)&&(this.in_header=!0),H&&32==c.charCodeAt(H-1)&&(c=c.replace(/\x20+$/,""))}else if(this.last_col_pipes)_[t]&&(c+=n[t]),t="blank";else if(P)return void(c+=P);if(("b"==t||"i"==t&&this.list_level)&&c.match(/(\/\/|\*)(\x20)+/)&&(c=c.replace(/(\/\/|\*)(\x20+)\-/,"$1\n$2-")),"li"==t&&this.list_level){1==this.list_level&!this.list_started&&(c+="\n",this.list_started=!0),c=c.replace(/[\x20]+$/,"");for(var D=0;D<this.list_level;D++)c.match(/_FORMAT_SPACE_\s*$/)&&(c=c.replace(/_FORMAT_SPACE_\s*$/,"\n")),this.list_level>1&&(c+="  ");this.prev_list_level>0&&n.li==n.ol&&(this.prev_list_level=-1)}if("a"==t&&this.list_level&&(HTMLLinkInList=!0),"a"==t&&w)return void(this.xcl_markup=!0);if("a"==t&&(this.export_code||this.code_snippet))return;if("a"==t&&this.footnote)t="fn_start";else if("a"==t&&E)y.push(this.id);else{if("a"==t&&this.external_mime)return this.in_endnotes?void(this.link_class="media"):void(C&&"mediafile"==C&&(c+=n.img,c+=this.attr+"|",this.is_mediafile=!0));if(this.in_font)return void("a"==t&&(c=c.replace(/__STYLE__/,"[["+this.attr+"|"),this.in_font=!1))}if(this.in_endnotes&&"a"==t)return;if(this.code_type&&"span"==t&&(t="blank"),this.mfile&&!this.attr&&(this.attr=this.mfile),c+=n[t],"td"==t||"th"==t||this.last_col_pipes&&"center"==this.td_align)this.is_rowspan&&(c+=n.row_span+" | ",this.is_rowspan=!1),"center"!=this.td_align&&"right"!=this.td_align||(c+="  ");else if("a"==t&&this.attr)this.attr=this.attr.replace(/%7c/,"%257c"),c+=this.attr+"|";else if("img"==t){var z=this.image_link_type;this.image_link_type="",this.link_only&&(z="link_only"),!z||v?z="nolink":"detail"==z&&(z=""),"link_only"==z?r="?linkonly":z&&(r+=z+"&"),a&&l?r+=a+"x"+l:a?r+=a:z||(r=""),g&&"left"!=g&&(c+="  "),this.attr+=r,"center"!=g&&"left"!=g||(this.attr+="  "),c+=k?this.attr+"|"+k+"}}":this.attr+"}}",this.attr="src"}else"pre"!=t&&"pre_td"!=t||(this.downloadable_file&&(this.attr+=" "+this.downloadable_file),this.attr||(this.attr="code"),c+=this.attr+">",this.downloadable_file="",this.downloadable_code=!1)}},end:function(t){if(_[t]&&(this.in_font||this.in_header)){if(c+=" ","sup"==t||"sub"==t||"del"==t||"strike"==t||"s"==t)var i="temp_c"+t;else i="temp_"+t;return c+=n[i],void(c+=" ")}if(!(this.in_endnotes&&"a"==t||this.in_link&&_[o]&&this.link_formats.length))if("a"!=t||this.link_formats.length||(this.in_link=!1),this.link_only)this.link_only=!1;else if(n[t]&&!("sup"==t&&"dwfcknote"==this.attr||this.is_smiley&&(this.is_smiley=!1,"li"!=t))){if("span"==t&&this.in_font&&!ckgedit_xcl_styles){t="font";var s="<font "+this.font_size+"/"+this.font_family+";;"+this.font_color+";;"+this.font_bgcolor+">",r=s.match(/(inherit)/g);r&&r.length<3&&(b=!0);var h=c.lastIndexOf("__STYLE__");c=(c=c.splice(h,9,s)).replace(/_FORMAT_SPACE_<font/m,"<font"),this.font_size="inherit",this.font_family="inherit",this.font_color="inherit",this.font_bgcolor="inherit",this.in_font=!1,w=!0,c=c.replace(/__STYLE__/g,"")}if("span"==t&&this.curid)this.curid=!1;else if("dl"==t&&this.downloadable_code)this.downloadable_code=!1;else{if(!e||"td"!=t&&"th"!=t||(this.current_cell.text=c.substring(this.cell_start),this.current_cell.text=this.current_cell.text.replace(/:::/gm,""),this.current_cell.text=this.current_cell.text.replace(/^[\s\|\^]+/,"")),"a"==t&&(this.export_code||this.code_snippet))return this.export_code=!1,void(this.code_snippet=!1);this.code_type&&"span"==t&&(t="blank");var o=t;if(this.footnote)t="fn_end",this.footnote=!1;else{if("a"==t&&this.xcl_markup)return void(this.xcl_markup=!1);"table"==t&&(this.in_table=!1,e&&(c=c.substring(0,this.table_start),function(t){if(e){for(var i=0;i<t.length&&a(t);i++);for(c+="\n",i=0;i<t.length;i++){c+="\n";for(var s=0;s<t[i].length;s++){var n="td"==t[i][s].type?"|":"^";c+=n;var l=!!t[i][s].align&&t[i][s].align;if("center"!=l&&"right"!=l||(c+="  "),c+=t[i][s].text,"center"!=l&&"left"!=l||(c+="  "),t[i][s].colspan)for(var r=0;r<t[i][s].colspan-1;r++)c+=n}c+="|"}}}(this.rows)))}if("p"==t)if(this.in_table)t="p_insert",d=!0;else if(this.list_started)return void(c+="\\\\ ");if(this.geshi)this.geshi=!1;else{if("code"!=t||this.list_started){if("a"==t&&"src"==this.attr&&this.backup("[[","{"))return}else if(c.match(/''\s*$/m))return void(c=c.replace(/''\s*$/,"\n"));if(this.end_nested)this.end_nested=!1;else{if("ol"==t||"ul"==t){if(this.list_level--,this.list_level||(this.format_in_list=!1),this.prev_li.length)return n.li=this.prev_li.pop(),void(this.end_nested=!0);t="\n\n"}else if("a"==t&&this.external_mime){if(this.external_mime=!1,!this.is_mediafile)return;t="}} "}else if("pre"==t){if(t=l[t],this.code_type)t+=this.code_type+">";else{var p=c.lastIndexOf("code"),m=c.lastIndexOf("file");this.code_type=m>p?"file":"code",t+=this.code_type+">"}this.code_type=!1}else l[t]?t=l[t]:"u"==this.attr&&"em"==t?t="u":"acronym"==t||(t=n[t]);if("tr"==o?(this.last_col_pipes&&(t="\n",this.last_col_pipes=""),this.td_rowspan&&this.rowspan_col==this.td_no+1&&(this.is_rowspan=!1,this.last_column=this.td_no,this.td_rowspan--,t="|"+n.row_span+"|\n")):"td"==o||"th"==o?(this.last_col_pipes="",this.in_td=!1):o.match(/h\d+/)&&(this.in_header=!1),n.li&&c.match(/\n$/)&&!this.list_level&&(t=""),!this.in_endnotes||"sup"!=o){if(c+=t,_[o]&&(this.list_level&&(this.format_in_list=!0,k=!0),c+=n.format_space,f=n.format_space),this.last_tag=o,this.td_colspan&&!e){"center"==this.td_align&&(c+=" ");var u="|";"th"==o&&(u="^");for(var g=u,v=1;v<this.td_colspan;v++)g+=u;this.last_col_pipes=g,c+=g,this.td_colspan=!1}else"center"==this.td_align&&(c+=" ",this.td_align="");if("a"==o&&this.link_formats.length){var y=c.substring(this.link_pos),E=c.substring(0,this.link_pos),C="",T="";for(v=0;v<this.link_formats.length;v++){var x=n[this.link_formats[v]],I=l[this.link_formats[v]]?l[this.link_formats[v]]:x;C+=n[this.link_formats[v]],T=I+T}c=(E+=C)+(y+=T),this.link_formats=new Array,this.in_link=!1}else"a"==o&&(this.link_formats=new Array,this.in_link=!1)}}}}}},chars:function(t){if((t=t.replace(/\t/g,"    ")).match(/~~START_HTML_BLOCK~~/)&&(t=t.replace(/~~START_HTML_BLOCK~~\n*/,"~~START_HTML_BLOCK~~\n<code>\n")),t.match(/~~CLOSE_HTML_BLOCK~~/)&&(t=t.replace(/~~CLOSE_HTML_BLOCK~~\n*/gm,"\n</code>\n\n~~CLOSE_HTML_BLOCK~~\n\n")),this.interwiki&&(t=t.replace(String.frasl,"/")),this.interwiki&&c.match(/>\w+\s*\|$/))return this.interwiki=!1,void(this.attr?c+=t:c=c.replace(/>\w+\s*\|$/,">"+t));if(this.in_multi_plugin&&(t=t.replace("&lt; ","&lt;")),t=(t=t.replace(/&#39;/g,"'")).replace(/^(&gt;)+/,function(t,e){return t.replace(/(&gt;)/g,"__QUOTE__")}),c=c.replace(/([\/\*_])_FORMAT_SPACE_([\/\*_]{2})_FORMAT_SPACE_$/,"$1$2@@_SP_@@"),t.match(/^&\w+;/)&&(c=c.replace(/_FORMAT_SPACE_\s*$/,"")),this.link_only)t&&(replacement="|"+t+"}} ",c=c.replace(/\}\}\s*$/,replacement));else{if(this.code_type){var e=(t=(t=t.replace(/&lt;\s/g,"<")).replace(/\s&gt;/g,">")).match(/^\s*geshi:\s+(.*)$/m);e&&(c=c.replace(/<(code|file)>\s*$/,"<$1 "+e[1]+">"),t=t.replace(e[0],""))}else this.last_col_pipes||(t=(t=(t=t.replace(/\x20{6,}/,"   ")).replace(/^(&nbsp;)+\s*$/,"_FCKG_BLANK_TD_")).replace(/(&nbsp;)+/," ")),this.format_tag?this.list_started&&!this.in_table||(t=t.replace(/^\s+/,"@@_SP_@@")):"a"==this.last_tag?t=t.replace(/^\s{2,}/," "):this.using_fonts||(t=t.replace(/^\s+/,"")),t.match(/nowiki&gt;/)&&(g=!0),(this.format_in_list||w&&this.list_started)&&(t=t.replace(/^[\n\s]+$/g,"")).match(/\n{2,}\s{1,}/)&&(t=t.replace(/\n{2,}/,"\n")),this.in_td&&!t&&(t="_FCKG_BLANK_TD_",this.in_td=!1);if(this.attr&&"dwfcknote"==this.attr){if(t.match(/fckgL\d+/))return;t.match(/^[\-,:;!_]/)?c+=t:c+=" "+t}else if(this.downloadable_code&&(this.export_code||this.code_snippet))this.downloadable_file=t;else if("a"==this.last_tag&&t.match(/^[\.,;\:\!]/)&&(c=c.replace(/\s$/,"")),this.in_header&&(t=(t=t.replace(/---/g,"&mdash;")).replace(/--/g,"&ndash;")),this.list_started&&(c=c.replace(/_LIST_EOFL_\s*L_BR_K\s*$/,"_LIST_EOFL_")),this.code_type||c.match(/\[\[\\\\.*?\|$/)||t.match(/\w:(\\(\w?))+/)||(t.match(/\\\\[\w\.\-\_]+\\[\w\.\-\_]+/)||(t=t.replace(/([\\])/g,"%%$1%%")),t=t.replace(/([\*])/g,"_CKG_ASTERISK_")),this.in_endnotes&&y.length){if(t.match(/\w/)&&!t.match(/^\s*\d\)\s*$/)){t=t.replace(/\)\s*$/,"_FN_PAREN_C_");var i=y.length-1;this.bottom_url&&(t=this.link_class&&"media"==this.link_class?"{{"+this.bottom_url+"|"+t+"}}":"[["+this.bottom_url+"|"+t+"]]"),E[y[i]]?(t=(t=t.replace("(","L_PARgr")).replace(")","R_PARgr"),E[y[i]]+=" "+t):(t=(t=t.replace("(","L_PARgr")).replace(")","R_PARgr"),E[y[i]]=t)}this.bottom_url=!1}else{t&&t.length&&(c+=t),c=c.replace(/(&\w+;)\s*([\*\/_]{2})_FORMAT_SPACE_(\w+)/,"$1$2$3"),this.list_level&&this.list_level>1&&(c=c.replace(/(\[\[.*?\]\])([ ]+[\*\-].*)$/," $1\n$2"));try{var s=new RegExp("([*/_]{2,})_FORMAT_SPACE_([*/_]{2,})("+RegExp.escape(t)+")$");c.match(s)&&(c=c.replace(s,"$1$2$3"))}catch(t){}C||t.match(/&lt;/)&&(C=!0)}}},comment:function(t){},dbg:function(t,e){t.replace&&!(t=(t=(t=t.replace(/^\s+/g,"")).replace(/^\n$/g,"")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))||(e&&(e="<b>"+e+"</b>\n"),HTMLParser_DEBUG+=e+t+"\n__________\n")}}),c=(c=(c=(c=(c=(c=(c=c.replace(/(\[\[\\\\)(.*?)\]\]/gm,function(t,e,i){return e+(i=i.replace(/\\/g,"_SMB_"))+"]]"})).replace(/%%\\%%/g,"_ESC_BKSLASH_")).replace(/%*\\%*([^\w]{1})%*\\%*/g,"$1")).replace(/_SMB_/g,"\\")).replace(/(\s*={2,}).*?CKGE_TMP_(\w+)(.*?).*?CKGE_TMP_c?\2.*?\1/gm,function(t,e){return t=t.replace(/CKGE_TMP_\w+/gm,""),jQuery("#formatdel").val()||jQuery("#dw__editform").append('<input type="hidden" id="formatdel" name="formatdel" value="del" />'),t})).replace(/\s?(CKGE_TMP_\w+)\s?/gm,function(t,e){return r[e]?r[e]:t})).replace(/(\s*={2,})(.*?)(\[\[|\{\{)(.*?)(\]\]|\}\})(.*?)\1/gm,function(t,e,i,s,a,n,l){return l=(l=l.replace(/\[\[(.*?)\|(.*?)\]\]/g,"$2")).replace(/\{\{(.*?)\|(.*?)\}\}/g,"$2"),t=e+" "+i+" "+a.replace(/.*?\|(.*?)/,"$1")+" "+l+" "+e,jQuery("#formatdel").val()||jQuery("#dw__editform").append('<input type="hidden" id="formatdel" name="formatdel" value="del" />'),t}),"test"!=t||HTMLParser_test_result(c)){if(c=(c=c.replace(/\{ \{ rss&gt;Feed:/gm,"{{rss&gt;http://")).replace(/~ ~ (NOCACHE|NOTOC)~ ~/gm,"~~$1~~"),v){c=c.replace(/\[\[(\w+\.?\w{0,12})>(.*?)\|(.*?)\]\]/gm,function(t,e,i,s){var a;return"oIWIKIocIWIKIc"==i&&(i=s),"[["+e+">"+i+(s=i=="oIWIKIo"+s.replace(/\s/,"%20")+"cIWIKIc"||i==s||(a=s,tag_1=i.replace(/oIWIKIo(.*)cIWIKIc/,"$1"),tag_1==a||(a=a.replace(/\s/,"%20"))==tag_1)?"":"|"+s)+"]]"})}if(c=c.replace(/>.*?oIWIKIo(.*?)cIWIKIc/gm,">$1"),f){m&&(c=c.replace(/\s*([\|\^]+)((\W\W_FORMAT_SPACE_)+)/gm,function(t,e,i){return(i=i.replace(/_FORMAT_SPACE_/g,""))+e})),c=c.replace(/&quot;/g,'"');var I=new RegExp(f+"([\\-]{2,})","g");c=(c=c.replace(I," $1")).replace(/\]\](\*\*|\/\/|\'\'|__|<\/del>)_FORMAT_SPACE_/,"]]$1@@_SP_@@");I=new RegExp("(&amp;|\\W|\\w|\\d)(\\*\\*|\\/\\/|\\'\\'|__|</del>)+"+f+"(\\w|\\d)","g");c=c.replace(I,"$1$2$3");I=new RegExp(f+"@@_SP_@@","g");c=(c=(c=(c=(c=c.replace(I," ")).replace(/([\*\/_]{2})@@_SP_@@(&\w+;)/g,"$1 $2")).replace(/\n@@_SP_@@\n/g,"")).replace(/@@_SP_@@\n/g,"")).replace(/@@_SP_@@/g," ");I=new RegExp(f+"([^\\)\\]\\}\\{\\-\\.,;:\\!?\"”’'])","g");c=c.replace(I," $1"),I=new RegExp(f,"g"),c=c.replace(I,""),k&&(c=c.replace(/(\s+[\-\*_]\s*)([\*\/_\']{2})(.*?)(\2)([^\n]*)\n+/gm,function(t,e,i,s,a,n){return e+i+s+a+n+"\n"}))}HTMLLinkInList&&(c=c.replace(/(\]\]|\}\})(\s+)(\*|-)/gm,function(t,e,i,s){return e+"\n"+(i=i.replace(/\n/,""))+s}));var K,$="\\\\";if(h&&(c=(c=(c=c.replace(/(L_BR_K)+/g,$)).replace(/L_BR_K/gm,$)).replace(/(\\\\)\s+/gm,"$1 \n")),o&&(c=c.replace(/\s+<\/(code|file)>/g,"\n</$1>"),p&&(c=(c=(c=c.replace(/\s+;/gm,";")).replace(/&lt;\s+/gm,"<")).replace(/\s+&gt;/gm,">"))),d){c+="\n\\\\\n";I=new RegExp(T,"g");c=(c=(c=c.replace(I," \\\\ ")).replace(/(\||\^)[ ]+(\||\^)\s$/g,"$1\n")).replace(/(\||\^)[ ]+(\||\^)/g,"$1")}if(c=c.replace(/_FCKG_BLANK_TD_/g," "),C&&(c=c.replace(/\/\/&lt;\/\/\s*/g,"&lt;")),w){if(String.prototype.font_link_reconcile=function(t){return I=1==t?/\[\[(.*?)(<font[^\>]+>)([^<]+(\]\])?)[^\>]+\/font>\s*(\]\])/gm:/(<font[^\>\{]+>)\{\{(:?.*?)\|(:?.*?)<\/font>/gm,this.replace(I,function(e,i,s,a){i=(i=(i=(i=i.replace(/\n/gm,"")).replace(/\s/gm,"")).replace(/[\[\]\{\}]/g,"")).replace(/\|/g,""),a=(a=(a=a.replace(/\n/gm,"")).replace(/\s/gm,"")).replace(/[\[\]\}\{]/g,""),a=1==t?"[["+i+"|"+a+"]]":"{{"+s+"|"+a+"}}";var n=prompt(LANG.plugins.ckgedit.font_err_1+"\n"+a+"\n"+LANG.plugins.ckgedit.font_err_2);if(null==n){if(ckgedit_to_dwedit)return ckgedit_to_dwedit=!1,a;throw new Error(LANG.plugins.ckgedit.font_err_throw)}return n||a})},b&&(c=c.replace(/<\/font>\s{1}/gm,"</font>")),K=/\>\s+(\*\*|__|\/\/|'')\s+_\s+\1\s+<\/font>/gm,c=c.replace(K,function(t){return t=t.replace(/\s+/g,"")}),K=new RegExp("\\>(.*?)(\\]\\]\\<\\/font\\>)|(\\<\\/font\\>\\]\\])","gm"),c.match(K)||(K=new RegExp("(\\{\\{(.*?)\\.\\w{2,4})\\|\\<font"),c.match(K)||(K=new RegExp("\\{\\{(.*?)\\.\\w{2,4}\\|[:\\w\\-\\.\\s]+\\<\\/font"),c.match(K)||(K=new RegExp("\\>\\{\\{(.*?)\\.\\w+\\<\\/font\\>\\b","gm"),c.match(K))))){if(confirm(LANG.plugins.ckgedit.font_conflict))return;jQuery("#fontdel").val()||jQuery("#dw__editform").append('<input type="hidden" id="fontdel" name="fontdel" value="del" />')}I=/\>\s+(\*\*|__|\/\/|'')\s+_\s+\1\s+<\/font>/gm;c=(c=(c=(c=(c=c.font_link_reconcile(1)).font_link_reconcile(2)).replace(I,function(t){return t=t.replace(/\s+/g,"")})).replace(/\[\[(.*?)\|(<font[^\>]+>)(.*?)(<\/font>)\s*(\]\])\s*/gm,function(t,e,i,s){return t="[["+e+"|"+s+"]]",jQuery("#fontdel").val()||jQuery("#dw__editform").append('<input type="hidden" id="fontdel" name="fontdel" value="del" />'),t})).replace(/(\s*={2,})\s*(.*?)(<font[^\>]+>)(.*?)(<\/font>)(.*?)\s*\1/gm,function(t){return t=(t=t.replace(/<\/font>/g," ")).replace(/<font.*?>/g," "),jQuery("#formatdel").val()||jQuery("#dw__editform").append('<input type="hidden" id="formatdel" name="formatdel" value="del" />'),t})}if(y.length){c=(c=c.replace(/<sup>\(\(\){2,}\s*<\/sup>/g,"")).replace(/\(\(+(\d+)\)\)+/,"(($1))");for(var P in E){var A=P.match(/_(\d+)/),R=new RegExp("(<sup>)*[(]+"+A[1]+"[)]+(</sup>)*");E[P]=E[P].replace(/(\d+)_FN_PAREN_C_/,""),c=c.replace(R,"(("+E[P].replace(/_FN_PAREN_C_/g,") ")+"))")}c=(c=c.replace(/<sup><\/sup>/g,"")).replace(/((<sup>\(\(\d+\)\)\)?<\/sup>))/gm,function(t){return t.match(/p>\(\(\d+/)?t:""})}if(c=(c=(c=c.replace(/(={3,}.*?)(\{\{.*?\}\})(.*?={3,})/g,"$1$3\n\n$2")).replace(/(<sup>)*\s*\[\[\s*\]\]\s*(<\/sup>)*\n*/g,"")).replace(/<sup>\s*\(\(\d+\)\)\s*<\/sup>/gm,""),u&&(c=(c=c.replace(/<\s+/g,"<")).replace(/&lt;\s+/g,"<")),g){I=new RegExp("([%])","g");c=c.replace(/(&lt;nowiki&gt;)(.*?)(&lt;\/nowiki&gt;)/gm,function(t,e,i,s){return e+(i=i.replace(/%%(.)%%/gm,"NOWIKI_$1_")).replace(I,"NOWIKI_$1_")+s})}if(c=(c=(c=(c=(c=c.replace(/__SWF__(\s*)\[*/g,"{{$1")).replace(/\|.*?\]*(\s*)__FWS__/g,"$1}}")).replace(/(\s*)__FWS__/g,"$1}}")).replace(/\n{3,}/g,"\n\n")).replace(/_LIST_EOFL_/gm," \\\\ "),e&&-1==c.indexOf("~~COMPLEX_TABLES~~")&&(c+="~~COMPLEX_TABLES~~\n"),e||(c=c.replace(/~~COMPLEX_TABLES~~/gm,"")),c=(c=c.replace(/_CKG_ASTERISK_/gm,"*")).replace(/_ESC_BKSLASH_/g,"\\"),"test"!=t){if(c=c.replace(/divalNLine/gm,"\n"),GetE("dw__editform").elements.fck_wikitext.value=c,"bakup"!=t)if(t)return GetE(t).click(),!0}else HTMLParser_test_result(c)&&alert(c)}}jQuery(document).ready(function(){var t=!1;jQuery(document).on("keypress","input#edit__summary",function(e){13==e.which&&(t=!0,jQuery("#save_button").trigger("mousedown"))}),jQuery("#ebut_test").mousedown(function(){parse_wikitext("test")}),jQuery("#ebtn__delete").click(function(){if(!t)return confirm(JSINFO.confirm_delete);t=!1}),jQuery("#ebtn__delete").mouseup(function(){draft_delete()}),jQuery("#ebtn__dwedit").click(function(){ckgedit_to_dwedit=!0,setDWEditCookie(2,this),parse_wikitext("edbtn__save"),this.form.submit()}),jQuery("#ebtn__fbswitch").click(function(){"dokuwiki"==getCookie("ckgFbOpt")?document.cookie="ckgFbOpt=ckgedit;":document.cookie="ckgFbOpt=dokuwiki;",parse_wikitext("edbtn__save"),this.form.submit()}),jQuery("#ckgedit_draft_btn").click(function(){ckgedit_get_draft()}),jQuery("#backup_button").click(function(){renewLock(!0)}),jQuery("#revert_to_prev_btn").click(function(){revert_to_prev()}),jQuery("#no_styling_btn").click(function(){this.form.styling.value="no_styles",this.form.prefix.value="",this.form.suffix.value="",this.form.rev.value=""}),jQuery("#ebut_cancel").mouseup(function(){draft_delete()}),jQuery("#save_button").mousedown(function(){this.form.template&&"tpl"==this.form.template.value&&(window.dwfckTextChanged=!0),window.dwfckTextChanged||JSINFO.cg_rev?parse_wikitext("edbtn__save"):(ckgedit_dwedit_reject=!0,parse_wikitext("ebut_cancel"))})});